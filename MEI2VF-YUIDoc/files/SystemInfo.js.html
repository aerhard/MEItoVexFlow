<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>SystemInfo.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/MEI2VF.html">MEI2VF</a></li>
            
                <li><a href="../classes/MEI2VF.Connectors
Handles stave connectors.html">MEI2VF.Connectors
Handles stave connectors</a></li>
            
                <li><a href="../classes/MEI2VF.Converter.html">MEI2VF.Converter</a></li>
            
                <li><a href="../classes/MEI2VF.Directives.html">MEI2VF.Directives</a></li>
            
                <li><a href="../classes/MEI2VF.Dynamics.html">MEI2VF.Dynamics</a></li>
            
                <li><a href="../classes/MEI2VF.EventLink.html">MEI2VF.EventLink</a></li>
            
                <li><a href="../classes/MEI2VF.EventReverence
Represents and event with its xmlid, but if the xmlid is not defined, it
can also hold the timestamp that can be resolved as soon as the context
that
holds the event is established. When the tstamp reference is being
resolved, the xml:id is calculated using the generic function tstamp2id(),
then the
xml:id stored, thus marking that the reference is resolved..html">MEI2VF.EventReverence
Represents and event with its xmlid, but if the xmlid is not defined, it
can also hold the timestamp that can be resolved as soon as the context
that
holds the event is established. When the tstamp reference is being
resolved, the xml:id is calculated using the generic function tstamp2id(),
then the
xml:id stored, thus marking that the reference is resolved.</a></li>
            
                <li><a href="../classes/MEI2VF.Hairpins.html">MEI2VF.Hairpins</a></li>
            
                <li><a href="../classes/MEI2VF.Hyphenation.html">MEI2VF.Hyphenation</a></li>
            
                <li><a href="../classes/MEI2VF.LinkCollection.html">MEI2VF.LinkCollection</a></li>
            
                <li><a href="../classes/MEI2VF.Measure.html">MEI2VF.Measure</a></li>
            
                <li><a href="../classes/MEI2VF.PointerCollection.html">MEI2VF.PointerCollection</a></li>
            
                <li><a href="../classes/MEI2VF.RUNTIME_ERROR.html">MEI2VF.RUNTIME_ERROR</a></li>
            
                <li><a href="../classes/MEI2VF.StaffInfo
Contains the definition and the rendering information (i.e. what
clef modifiers are to be rendered) of a single staff.html">MEI2VF.StaffInfo
Contains the definition and the rendering information (i.e. what
clef modifiers are to be rendered) of a single staff</a></li>
            
                <li><a href="../classes/MEI2VF.StaffVoice.html">MEI2VF.StaffVoice</a></li>
            
                <li><a href="../classes/MEI2VF.StaveVoices
Stores all voices in a given measure along with the respective staff id.
Passes all voices to Vex.Flow.Formatter and calls joinVoices, then draws
all voices..html">MEI2VF.StaveVoices
Stores all voices in a given measure along with the respective staff id.
Passes all voices to Vex.Flow.Formatter and calls joinVoices, then draws
all voices.</a></li>
            
                <li><a href="../classes/MEI2VF.System.html">MEI2VF.System</a></li>
            
                <li><a href="../classes/MEI2VF.SystemInfo
Deals with MEI data provided by scoreDef, staffDef and staffGrp elements and its children.html">MEI2VF.SystemInfo
Deals with MEI data provided by scoreDef, staffDef and staffGrp elements and its children</a></li>
            
                <li><a href="../classes/MEI2VF.Ties.html">MEI2VF.Ties</a></li>
            
                <li><a href="../classes/MEI2VF.Util.html">MEI2VF.Util</a></li>
            
                <li><a href="../classes/MeiLib.html">MeiLib</a></li>
            
                <li><a href="../classes/MeiLib
MeiLib - General purpose JavaScript functions for processing MEI documents..html">MeiLib
MeiLib - General purpose JavaScript functions for processing MEI documents.</a></li>
            
                <li><a href="../classes/MeiLib.Alt
Represents an MEI &lt;b&gt;app&lt;/b&gt; or &lt;b&gt;choice&lt;/b&gt; element..html">MeiLib.Alt
Represents an MEI &lt;b&gt;app&lt;/b&gt; or &lt;b&gt;choice&lt;/b&gt; element.</a></li>
            
                <li><a href="../classes/MeiLib.EventEnumerator
Enumerate over the children events of node (node is a layer or a beam)..html">MeiLib.EventEnumerator
Enumerate over the children events of node (node is a layer or a beam).</a></li>
            
                <li><a href="../classes/MeiLib.MeiDoc
A Rich MEI is an MEI that contain ambiguity represented by Critical Apparatus
(&lt;b&gt;app&lt;/b&gt;, &lt;b&gt;rdg&lt;/b&gt;, etc.), or Editorial Transformation (&lt;b&gt;choice&lt;/b&gt;, &lt;b&gt;corr&lt;/b&gt;, etc.)
elements..html">MeiLib.MeiDoc
A Rich MEI is an MEI that contain ambiguity represented by Critical Apparatus
(&lt;b&gt;app&lt;/b&gt;, &lt;b&gt;rdg&lt;/b&gt;, etc.), or Editorial Transformation (&lt;b&gt;choice&lt;/b&gt;, &lt;b&gt;corr&lt;/b&gt;, etc.)
elements.</a></li>
            
                <li><a href="../classes/MeiLib.RuntimeError.html">MeiLib.RuntimeError</a></li>
            
                <li><a href="../classes/MeiLib.Variant
Represents a &lt;b&gt;lem&lt;/b&gt;, &lt;b&gt;rdg&lt;/b&gt;, &lt;b&gt;sic&lt;/b&gt; or &lt;b&gt;corr&lt;/b&gt; element..html">MeiLib.Variant
Represents a &lt;b&gt;lem&lt;/b&gt;, &lt;b&gt;rdg&lt;/b&gt;, &lt;b&gt;sic&lt;/b&gt; or &lt;b&gt;corr&lt;/b&gt; element.</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: SystemInfo.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
var MEI2VF = ( function(m2v, VF, $, undefined) {

    /**
     * @class MEI2VF.SystemInfo
     * Deals with MEI data provided by scoreDef, staffDef and staffGrp elements and its children
     * @private
     *
     * @constructor

     */
    m2v.SystemInfo = function() {
      return;
    };

    m2v.SystemInfo.prototype = {

      // currently fixed
      STAVE_HEIGHT : 40, // VF.Staff.spacing_between_lines_px * 4;

      init : function(cfg, printSpace) {
        var me = this;
        me.cfg = cfg;
        me.printSpace = printSpace;

        /**
         * contains the current {@link MEI2VF.StaffInfo} objects
         */
        me.currentStaffInfos = [];
        /**
         * @property {Number} systemLeftMar the left margin of the
         * current system (additional to the left print space margin)
         */
        me.systemLeftMar = undefined;
        /**
         * @property {Number} currentLowestY the lowest Y coordinate of the
         * previously processed staffs
         */
        me.currentLowestY = 0;
        
        me.startConnectorInfos = {};
        me.inlineConnectorInfos = {}; 
        
      },

      setLeftMar : function(width) {
        this.systemLeftMar = width;
      },

      getLeftMar : function() {
        return this.systemLeftMar;
      },

      setModelForStaveRange : function(target, obj, add) {
        add = add || &#x27;&#x27;;
        target[obj.top_staff_n + &#x27;:&#x27; + obj.bottom_staff_n + add] = obj;
      },

      /**
       *
       */
      setConnectorModels : function(staffGrp, range, isChild) {
        var me = this, symbol, barthru, first_n, last_n;

        first_n = range.first_n;
        last_n = range.last_n;
        symbol = $(staffGrp).attr(&#x27;symbol&#x27;);
        barthru = $(staffGrp).attr(&#x27;barthru&#x27;);

        m2v.L(&#x27;Converter.setConnectorModels() {2}&#x27;, &#x27;symbol: &#x27; + symbol, &#x27; range.first_n: &#x27; + first_n, &#x27; range.last_n: &#x27; + last_n);

        // # left connectors specified in the MEI file
        me.setModelForStaveRange(me.startConnectorInfos, {
          top_staff_n : first_n,
          bottom_staff_n : last_n,
          symbol : symbol || &#x27;line&#x27;,
          label : $(staffGrp).attr(&#x27;label&#x27;),
          labelAbbr : $(staffGrp).attr(&#x27;label.abbr&#x27;)
        });

        // # left auto line, only (if at all) attached to
        // //staffGrp[not(ancestor::staffGrp)]
        if (!isChild &amp;&amp; me.cfg.autoStaveConnectorLine) {
          me.setModelForStaveRange(me.startConnectorInfos, {
            top_staff_n : first_n,
            bottom_staff_n : last_n,
            symbol : (symbol === &#x27;none&#x27;) ? &#x27;none&#x27; : &#x27;line&#x27;
          }, &#x27;autoline&#x27;);
        }

        // # inline connectors
        if (barthru === &#x27;true&#x27;) {
          me.setModelForStaveRange(me.inlineConnectorInfos, {
            top_staff_n : first_n,
            bottom_staff_n : last_n,
            symbol : &#x27;singleright&#x27; // default
          });
        }
      },

      getStaffInfo : function(staff_n) {
        return this.currentStaffInfos[staff_n];
      },

      getAllStaffInfos : function() {
        return this.currentStaffInfos;
      },

      /**
       *
       */
      getClef : function(staff_n) {
        var me = this, staff_info;
        staff_info = me.currentStaffInfos[staff_n];
        if (!staff_info) {
          throw new m2v.RUNTIME_ERROR(&#x27;MEI2VF.getClefForStaffNr():E01&#x27;, &#x27;No staff definition for staff n=&#x27; + staff_n);
        }
        return staff_info.getClef();
      },

      getCurrentLowestY : function() {
        return this.currentLowestY;
      },

      setCurrentLowestY : function(y) {
        this.currentLowestY = y;
      },

      getYs : function(currentSystemY) {
        var me = this, currentStaffY, i, j, isFirstStaff = true, infoSpacing, lowestYCandidate, ys = [];
        currentStaffY = 0;
        for ( i = 1, j = me.currentStaffInfos.length; i &lt; j; i += 1) {
          if (me.currentStaffInfos[i]) {
            infoSpacing = me.currentStaffInfos[i].spacing;
            currentStaffY += (isFirstStaff) ? 0 : (infoSpacing !== null) ? me.STAVE_HEIGHT + me.currentStaffInfos[i].spacing : me.STAVE_HEIGHT + me.cfg.staveSpacing;
            ys[i] = currentSystemY + currentStaffY;
            isFirstStaff = false;
          }
        }
        lowestYCandidate = currentSystemY + currentStaffY + me.STAVE_HEIGHT;
        if (lowestYCandidate &gt; me.currentLowestY)
          me.currentLowestY = lowestYCandidate;
        return ys;
      },

      forceSectionStartInfos : function() {
        var me = this, i = me.currentStaffInfos.length;
        while (i--) {
          if (me.currentStaffInfos[i])
            me.currentStaffInfos[i].forceSectionStartInfo();
        }
      },

      forceStaveStartInfos : function() {
        var me = this, i = me.currentStaffInfos.length;
        while (i--) {
          if (me.currentStaffInfos[i])
            me.currentStaffInfos[i].forceStaveStartInfo();
        }
      },

      /**
       *
       */
      processScoreDef : function(scoredef) {
        var me = this, i, j, children, systemLeftmar;
        systemLeftmar = $(scoredef).attr(&#x27;system.leftmar&#x27;);
        if ( typeof systemLeftmar === &#x27;string&#x27;) {
          me.setLeftMar(+systemLeftmar);
        }
        children = $(scoredef).children();
        for ( i = 0, j = children.length; i &lt; j; i += 1) {
          me.processScoreDef_child(children[i]);
        }
      },

      /**
       * MEI element &lt;b&gt;scoreDef&lt;/b&gt; may contain (MEI v2.1.0):
       * MEI.cmn: &lt;b&gt;meterSig&lt;/b&gt; &lt;b&gt;meterSigGrp&lt;/b&gt;
       * MEI.harmony: &lt;b&gt;chordTable&lt;/b&gt; MEI.linkalign:
       * &lt;b&gt;timeline&lt;/b&gt; MEI.midi: &lt;b&gt;instrGrp&lt;/b&gt; MEI.shared:
       * &lt;b&gt;keySig&lt;/b&gt; &lt;b&gt;pgFoot&lt;/b&gt; &lt;b&gt;pgFoot2&lt;/b&gt; &lt;b&gt;pgHead&lt;/b&gt;
       * &lt;b&gt;pgHead2&lt;/b&gt; &lt;b&gt;staffGrp&lt;/b&gt; MEI.usersymbols:
       * &lt;b&gt;symbolTable&lt;/b&gt;
       *
       * Supported elements: &lt;b&gt;staffGrp&lt;/b&gt; &lt;b&gt;pgHead&lt;/b&gt;
       *
       * @param {XMLElement} element the scoreDef element to process
       */
      processScoreDef_child : function(element) {
        var me = this;
        switch (element.localName) {
          case &#x27;staffGrp&#x27; :
            me.processStaffGrp(element);
            break;
          case &#x27;pgHead&#x27; :
            me.processPgHead(element);
            break;
          default :
            throw new m2v.RUNTIME_ERROR(&#x27;MEI2VF.RERR.NotSupported&#x27;, &#x27;Element &lt;&#x27; + element.localName + &#x27;&gt; is not supported in &lt;scoreDef&gt;&#x27;);
        }
      },

      /**
       *
       */
      processPgHead : function(unused_element) {
        return;
      },

      /**
       *
       * @param {XMLElement} staffGrp
       * @param {Boolean} isChild specifies if the staffGrp is a child of another
       *            staffGrp (auto staff connectors only get attached
       *            to the outermost staffGrp elements)
       * @return {Object} the range of the current staff group. Properties:
       *         first_n, last_n
       */
      processStaffGrp : function(staffGrp, isChild) {
        var me = this, range = {};
        $(staffGrp).children().each(function(i, childElement) {
          var childRange = me.processStaffGrp_child(childElement);
          m2v.L(&#x27;Converter.processStaffGrp() {1}.{a}&#x27;, &#x27;childRange.first_n: &#x27; + childRange.first_n, &#x27; childRange.last_n: &#x27; + childRange.last_n);
          if (i === 0)
            range.first_n = childRange.first_n;
          range.last_n = childRange.last_n;
        });
        me.setConnectorModels(staffGrp, range, isChild);
        return range;
      },

      /**
       * MEI element &lt;b&gt;staffGrp&lt;/b&gt; may contain (MEI v2.1.0): MEI.cmn: meterSig
       * meterSigGrp MEI.mensural: mensur proport MEI.midi: instrDef
       * MEI.shared: clef clefGrp keySig label layerDef
       *
       * Supported elements: &lt;b&gt;staffGrp&lt;/b&gt; &lt;b&gt;staffDef&lt;/b&gt;
       *
       * @param {XMLElement} element
       * @return {Object} the range of staffs. Properties: first_n, last_n
       */
      processStaffGrp_child : function(element) {
        var me = this, staff_n;
        switch (element.localName) {
          case &#x27;staffDef&#x27; :
            staff_n = me.processStaffDef(element);
            return {
              first_n : staff_n,
              last_n : staff_n
            };
          case &#x27;staffGrp&#x27; :
            return me.processStaffGrp(element, true);
          default :
            throw new m2v.RUNTIME_ERROR(&#x27;MEI2VF.RERR.NotSupported&#x27;, &#x27;Element &lt;&#x27; + element.localName + &#x27;&gt; is not supported in &lt;staffGrp&gt;&#x27;);
        }
      },

      /**
       * reads a staffDef, writes it to currentStaffInfos
       *
       * @param {XMLElement} staffDef
       * @return {Number} the staff number of the staffDef
       */
      processStaffDef : function(staffDef) {
        var me = this, staff_n, staff_info;
        staff_n = +$(staffDef).attr(&#x27;n&#x27;);
        staff_info = me.currentStaffInfos[staff_n];
        if (staff_info) {
          staff_info.updateDef(staffDef);
        } else {
          me.currentStaffInfos[staff_n] = new m2v.StaffInfo(staffDef, true, true, true);
        }
        return staff_n;
      }
    };

    return m2v;

  }(MEI2VF || {}, Vex.Flow, jQuery));

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
