<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>System.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/MEI2VF.html">MEI2VF</a></li>
            
                <li><a href="../classes/MEI2VF.Connectors
Handles stave connectors.html">MEI2VF.Connectors
Handles stave connectors</a></li>
            
                <li><a href="../classes/MEI2VF.Converter.html">MEI2VF.Converter</a></li>
            
                <li><a href="../classes/MEI2VF.Directives.html">MEI2VF.Directives</a></li>
            
                <li><a href="../classes/MEI2VF.Dynamics.html">MEI2VF.Dynamics</a></li>
            
                <li><a href="../classes/MEI2VF.EventLink.html">MEI2VF.EventLink</a></li>
            
                <li><a href="../classes/MEI2VF.EventReverence
Represents and event with its xmlid, but if the xmlid is not defined, it
can also hold the timestamp that can be resolved as soon as the context
that
holds the event is established. When the tstamp reference is being
resolved, the xml:id is calculated using the generic function tstamp2id(),
then the
xml:id stored, thus marking that the reference is resolved..html">MEI2VF.EventReverence
Represents and event with its xmlid, but if the xmlid is not defined, it
can also hold the timestamp that can be resolved as soon as the context
that
holds the event is established. When the tstamp reference is being
resolved, the xml:id is calculated using the generic function tstamp2id(),
then the
xml:id stored, thus marking that the reference is resolved.</a></li>
            
                <li><a href="../classes/MEI2VF.Hairpins.html">MEI2VF.Hairpins</a></li>
            
                <li><a href="../classes/MEI2VF.Hyphenation.html">MEI2VF.Hyphenation</a></li>
            
                <li><a href="../classes/MEI2VF.LinkCollection.html">MEI2VF.LinkCollection</a></li>
            
                <li><a href="../classes/MEI2VF.Measure.html">MEI2VF.Measure</a></li>
            
                <li><a href="../classes/MEI2VF.PointerCollection.html">MEI2VF.PointerCollection</a></li>
            
                <li><a href="../classes/MEI2VF.RUNTIME_ERROR.html">MEI2VF.RUNTIME_ERROR</a></li>
            
                <li><a href="../classes/MEI2VF.StaffInfo
Contains the definition and the rendering information (i.e. what
clef modifiers are to be rendered) of a single staff.html">MEI2VF.StaffInfo
Contains the definition and the rendering information (i.e. what
clef modifiers are to be rendered) of a single staff</a></li>
            
                <li><a href="../classes/MEI2VF.StaffVoice.html">MEI2VF.StaffVoice</a></li>
            
                <li><a href="../classes/MEI2VF.StaveVoices
Stores all voices in a given measure along with the respective staff id.
Passes all voices to Vex.Flow.Formatter and calls joinVoices, then draws
all voices..html">MEI2VF.StaveVoices
Stores all voices in a given measure along with the respective staff id.
Passes all voices to Vex.Flow.Formatter and calls joinVoices, then draws
all voices.</a></li>
            
                <li><a href="../classes/MEI2VF.System.html">MEI2VF.System</a></li>
            
                <li><a href="../classes/MEI2VF.SystemInfo
Deals with MEI data provided by scoreDef, staffDef and staffGrp elements and its children.html">MEI2VF.SystemInfo
Deals with MEI data provided by scoreDef, staffDef and staffGrp elements and its children</a></li>
            
                <li><a href="../classes/MEI2VF.Ties.html">MEI2VF.Ties</a></li>
            
                <li><a href="../classes/MEI2VF.Util.html">MEI2VF.Util</a></li>
            
                <li><a href="../classes/MeiLib.html">MeiLib</a></li>
            
                <li><a href="../classes/MeiLib
MeiLib - General purpose JavaScript functions for processing MEI documents..html">MeiLib
MeiLib - General purpose JavaScript functions for processing MEI documents.</a></li>
            
                <li><a href="../classes/MeiLib.Alt
Represents an MEI &lt;b&gt;app&lt;/b&gt; or &lt;b&gt;choice&lt;/b&gt; element..html">MeiLib.Alt
Represents an MEI &lt;b&gt;app&lt;/b&gt; or &lt;b&gt;choice&lt;/b&gt; element.</a></li>
            
                <li><a href="../classes/MeiLib.EventEnumerator
Enumerate over the children events of node (node is a layer or a beam)..html">MeiLib.EventEnumerator
Enumerate over the children events of node (node is a layer or a beam).</a></li>
            
                <li><a href="../classes/MeiLib.MeiDoc
A Rich MEI is an MEI that contain ambiguity represented by Critical Apparatus
(&lt;b&gt;app&lt;/b&gt;, &lt;b&gt;rdg&lt;/b&gt;, etc.), or Editorial Transformation (&lt;b&gt;choice&lt;/b&gt;, &lt;b&gt;corr&lt;/b&gt;, etc.)
elements..html">MeiLib.MeiDoc
A Rich MEI is an MEI that contain ambiguity represented by Critical Apparatus
(&lt;b&gt;app&lt;/b&gt;, &lt;b&gt;rdg&lt;/b&gt;, etc.), or Editorial Transformation (&lt;b&gt;choice&lt;/b&gt;, &lt;b&gt;corr&lt;/b&gt;, etc.)
elements.</a></li>
            
                <li><a href="../classes/MeiLib.RuntimeError.html">MeiLib.RuntimeError</a></li>
            
                <li><a href="../classes/MeiLib.Variant
Represents a &lt;b&gt;lem&lt;/b&gt;, &lt;b&gt;rdg&lt;/b&gt;, &lt;b&gt;sic&lt;/b&gt; or &lt;b&gt;corr&lt;/b&gt; element..html">MeiLib.Variant
Represents a &lt;b&gt;lem&lt;/b&gt;, &lt;b&gt;rdg&lt;/b&gt;, &lt;b&gt;sic&lt;/b&gt; or &lt;b&gt;corr&lt;/b&gt; element.</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: System.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
var MEI2VF = ( function(m2v, VF, $, undefined) {

    // TODO width calculation: take end modifiers into account (do this later: end
    // modifiers are currently not part of mei2vf)

    /**
     * A single instance of a staff system, containing and processing information
     * about the measures contained
     * @class MEI2VF.System
     * @private
     *
     * @constructor
     * @param {Object} config The configuration object
     */
    m2v.System = function(config) {
      this.init(config);
    };

    m2v.System.prototype = {

      /**
       * @property {Number} LABEL_PADDING the padding (in pixels) between the voice
       * labels and the staves
       */
      LABEL_PADDING : 20,

      /**
       * @param {Object} config The configuration object
       */
      init : function(config) {
        var me = this;

        /**
         * @cfg {Number|null} leftMar the left system margin as specified in the
         * MEI file or null if there is no margin specified. In the latter case,
         * the margin will be calculated on basis of the text width of the labels
         */
        me.leftMar = config.leftMar;
        /**
         * @cfg {Object} coords the coords of the current system
         * @cfg {Number} coords.x the x coordinate of the system
         * @cfg {Number} coords.y the y coordinate of the system
         * @cfg {Number} coords.w the system width
         */
        me.coords = config.coords;
        /**
         * @cfg {Number[]} staffYs the y coordinates of all staffs in the current
         * system
         */
        me.staffYs = config.staffYs;
        /**
         * @cfg {String[]} labels the labels of all staffs in the current system
         */
        me.labels = config.labels;
        /**
         * @property {MEI2VF.Measure[]} measures the measures in the current
         * system
         */
        me.measures = [];
      },

      /**
       * @return {Number[]} the value of {@link #staffYs}
       */
      getStaffYs : function() {
        return this.staffYs;
      },

      /**
       * adds a measure to the end of the measure array
       * @param {MEI2VF.Measure} measure the measure to add
       */
      addMeasure : function(measure) {
        this.measures.push(measure);
      },

      /**
       * gets a measure in the current system at the specified index
       * @param {Number} i the measure index (the first measure in the current
       * system has the index 0)
       * @return {MEI2VF.Measure}
       */
      getMeasure : function(i) {
        return this.measures[i];
      },

      /**
       * gets all measures in the current system
       * @return {MEI2VF.Measure[]}
       */
      getMeasures : function() {
        return this.measures;
      },

      /**
       * Calculates the system indent based on the width of the stave and
       * stave-connector labels
       * @param {Object} ctx the canvas context
       */
      calculateInitialIndent : function(ctx) {
        var me = this, label, max = 0, w, connectors, i, text;
        ctx.setFont(&#x27;Times&#x27;, 16);
        for (label in me.labels) {
          text = me.labels[label];
          if ( typeof text === &#x27;string&#x27;) {
            w = ctx.measureText(me.labels[label]).width;
            if (max &lt; w) {
              max = w;
            }
          }
        }
        connectors = me.getMeasures()[0].startConnectors.getAll();
        i = connectors.length;
        while (i--) {
          text = connectors[i].text;
          if ( typeof text === &#x27;string&#x27;) {
            w = ctx.measureText(me.labels[label]).width;
            if (max &lt; w) {
              max = w;
            }
          }
        }
        me.leftMar = (max === 0) ? 0 : max + me.LABEL_PADDING;
      },

      /**
       * Calculates the minimum width of each measure in the current system
       */
      calculateMeasureMinWidths : function() {
        var measures = this.measures, i = measures.length;
        while (i--) {
          measures[i].calculateMinWidth();
        }
      },

      /**
       * calculates the width of all measures in a stave which don&#x27;t have a
       * specified width in the MEI code and writes them to their enclosing
       * measure object
       */
      calculateMissingMeasureWidths : function() {
        var me = this, i, j, totalSpecifiedMeasureWidth = 0, avaliableSingleWidth, nonSpecified_n = 0;
        for ( i = 0, j = me.measures.length; i &lt; j; i += 1) {
          if (me.measures[i].meiW === null) {
            nonSpecified_n += 1;
            totalSpecifiedMeasureWidth += me.measures[i].getMinWidth();
          } else {
            totalSpecifiedMeasureWidth += me.measures[i].meiW;
          }
        }
        avaliableSingleWidth = Math.floor((me.coords.w - me.leftMar - totalSpecifiedMeasureWidth) / nonSpecified_n);
        for ( i = 0, j = me.measures.length; i &lt; j; i += 1) {
          if (me.measures[i].meiW === null) {
            me.measures[i].w = avaliableSingleWidth + me.measures[i].getMinWidth();
          } else {
            me.measures[i].w = me.measures[i].meiW;
          }
        }
      },

      /**
       * formats the measures in the current system
       * @param {Object} ctx the canvas context
       * @return {MEI2VF.System} this
       */
      format : function(ctx) {
        var me = this, i, j, measures, offsetX, labels;
        if ( typeof me.leftMar !== &#x27;number&#x27;) {
          me.calculateInitialIndent(ctx);
        }
        me.calculateMeasureMinWidths();
        me.calculateMissingMeasureWidths();
        offsetX = me.coords.x + me.leftMar;
        measures = me.getMeasures();
        for ( i = 0, j = measures.length; i &lt; j; i += 1) {
          if (measures[i]) {
            labels = (i === 0) ? me.labels : null;
            measures[i].format(offsetX, labels);
            offsetX += measures[i].w;
          }
          measures[i].addTempoToStaves();
        }
        return me;
      },

      /**
       * draws the current system to a canvas
       * @param {Object} ctx the canvas context
       */
      draw : function(ctx) {
        var me = this, i = me.measures.length;
        while (i--) {
          if (me.measures[i]) {
            me.measures[i].draw(ctx);
          }
        }
      }
    };

    return m2v;

  }(MEI2VF || {}, Vex.Flow, jQuery));

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
